<div class="chat-bubble assistant">
    <div class="meta">CapaRAG</div>
    <div class="answer-text">{{ answer.answer | regex_replace('\[(\d+)\]', '<a href="#cite-\\1" class="cite-marker">[\\1]</a>') | safe }}</div>

    {% if answer.citations %}
    <div class="citations-block">
        {% for c in answer.citations %}
        <div class="citation-ref" id="cite-{{ c.index }}">
            <span class="cite-index">[{{ c.index }}]</span>
            <span class="cite-source">{{ c.source }}</span>
            <blockquote>{{ c.quote }}</blockquote>
        </div>
        {% endfor %}
    </div>
    {% endif %}

    {% if answer.sources %}
    <p><strong>Sources:</strong> {{ answer.sources | join(", ") }}</p>
    {% endif %}

    {% if answer.see_also %}
    <p><strong>See also:</strong>
        {% for term in answer.see_also %}
        <span class="see-also-tag">{{ term }}</span>
        {% endfor %}
    </p>
    {% endif %}
</div>
