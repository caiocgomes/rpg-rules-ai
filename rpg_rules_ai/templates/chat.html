{% extends "base.html" %}
{% block title_suffix %} - Chat{% endblock %}
{% block content %}
<h2>Chat</h2>

<div id="chat-messages" role="log" aria-live="polite" aria-label="Chat messages"></div>

<form hx-post="/chat/ask"
      hx-target="#chat-messages"
      hx-swap="beforeend"
      hx-indicator="#chat-loading"
      hx-disabled-elt="button[type='submit']"
      hx-on::after-request="this.reset(); document.getElementById('thread_id').value = window.__threadId; document.getElementById('chat-messages').scrollTop = document.getElementById('chat-messages').scrollHeight;">
    <input type="hidden" id="thread_id" name="thread_id">
    <label for="question" class="sr-only">Ask a question about RPG rules</label>
    <fieldset role="group">
        <input type="text" id="question" name="question" placeholder="Ask a question about RPG rules..." required autofocus>
        <button type="submit">Send</button>
    </fieldset>
    <span id="chat-loading" class="htmx-indicator" role="status" aria-live="polite">Thinking...</span>
</form>

<script>
window.__threadId = crypto.randomUUID();
document.getElementById('thread_id').value = window.__threadId;
</script>
{% endblock %}
